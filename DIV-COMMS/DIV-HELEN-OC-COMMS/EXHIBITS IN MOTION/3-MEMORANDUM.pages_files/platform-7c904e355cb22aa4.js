(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[12646],{908:(e,t,n)=>{"use strict";n.d(t,{G1:()=>v,QO:()=>l,u9:()=>d});var r=n(85819),o=n(95974),i=n(96914),a=n(12632);let l=e=>{let t=new URL(e),n=t.searchParams;return n.get("version")||n.set("version",a.mj),n.get("source")||n.set("source",a.tl),t},s=e=>{switch(e){case 400:case 403:case 404:default:return!1;case 409:case 500:case 429:return!0}},c=e=>{if(!e)return 0;let t=parseInt(e,10);if(!isNaN(t))return Math.max(0,1e3*t);let n=new Date(e).getTime();return isNaN(n)?0:Math.max(0,n-Date.now())},u=(e,t,n)=>n+e*Math.pow(2,t),d=async e=>{var t,n;let r,{resource:l,options:d={},timeoutMs:v=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1200;try{let t=globalThis.navigator.userAgent.includes("Mobile")&&!globalThis.navigator.userAgent.includes("iPad"),n="unknown",r=10;if(globalThis.navigator.connection&&(n=globalThis.navigator.connection.type,r=globalThis.navigator.connection.downlink),t||r<1||"cellular"===n)return 2*e;return e}catch(t){return e}}(),method:h="GET",body:f,numRetries:E=0,backOffTime:_=1e3,metrics:g,reason:p}=e,m={...d,method:h,body:f},w=new Headers(m.headers);w.set(a.Hq,p);let T=()=>null;if(v&&(T=()=>{let e=new DOMException("fetch ".concat(l," timed out (").concat(v,"ms)"),"TimeoutError"),t=new AbortController;return m.signal=t.signal,setTimeout(()=>t.abort(e),v)}),E>2){let e="Retries for fetch ".concat(l," exceeded MAX_RETRIES");o.vF.error(Error(e))}let y=null,b=_,L=0,S=0;do{E>0&&S>0&&await new Promise(e=>setTimeout(e,b));let e=T();L=0,r=void 0;try{if(w.set("X-Perplexity-Request-Try-Number",String(S+1)),w.set("X-Perplexity-Request-Endpoint",String(l)),y=await fetch(l,{...m,headers:w}),clearTimeout(e),!y.ok&&s(y.status))L=c(y.headers.get("Retry-After"));else break}catch(e){r=e}clearTimeout(e),b=u(_,S,L),++S}while(S<=E);if(r)throw o.vF.log("".concat(m.method," ").concat(l," exception"),r),r._fetchMethod=m.method,r._fetchResource=l,g&&(0,i.Rh)(null!==(t=g.metricName)&&void 0!==t?t:"web.rest_api_call.failed",g),r;return g&&(0,i.Rh)(null!==(n=g.metricName)&&void 0!==n?n:"web.rest_api_call.success",g),y};async function v(e){var t,n;let{url:a,params:l,handlers:s,legacyEvents:c={},headers:u={},signal:d,metrics:v={},timer:h}=e,f=null!==(t=c.message)&&void 0!==t?t:"message",E=null!==(n=c.endOfStream)&&void 0!==n?n:"end_of_stream",_=c.message&&c.endOfStream,{now:g,...p}=v;h?h.setGlobalContext({path:a.pathname,...p}):h=(0,i.Ip)({path:a.pathname,...p},{nowFromTimeOrigin:performance.now()});let{addTiming:m,addTimingOnce:w}=h;return m("web.sse.start"),new Promise((e,t)=>{let n,o;let c=new r.G(a,{withCredentials:!0,fetch:(e,t)=>{var n;return fetch(e,{...t,method:"POST",body:l?JSON.stringify(l):void 0,credentials:"include",signal:d,headers:{"content-type":"application/json",...null!==(n=null==t?void 0:t.headers)&&void 0!==n?n:{},...u}})}});function v(){clearTimeout(n),n=setTimeout(()=>{try{c.close()}catch(e){}finally{L()}t(Error("Stream timeout - no messages received"))},3e5)}function h(e){clearTimeout(n);try{c.close()}catch(e){}finally{L()}t(Error("Stream error",{cause:e}))}let g=e=>{h(Error("Stream error - ".concat(e.code," - ").concat(e.message),{cause:e}))},p=()=>{var e;v(),m("web.sse.connection_opened"),null===(e=s.open)||void 0===e||e.call(s)},T=e=>{let t;try{w("web.sse.first_message_seen"),o=o?void 0:(0,i.Ip)({path:a.pathname}),v(),t=JSON.parse(e.data)}catch(e){return h(e)}s.message(t)},y=t=>{let r;try{w("web.sse.first_message_seen"),clearTimeout(n);try{c.close()}catch(e){}finally{L()}r=JSON.parse(t.data)}catch(e){return h(e)}_&&s.message(r),m("web.sse.end_of_stream"),e()},b=e=>{var t;let n;try{n=JSON.parse(e.data)}catch(e){return h(e)}null===(t=s.info)||void 0===t||t.call(s,n)};c.addEventListener("error",g),c.addEventListener("open",p),c.addEventListener(f,T),c.addEventListener(E,y),c.addEventListener("info",b);let L=()=>{c.removeEventListener("error",g),c.removeEventListener("open",p),c.removeEventListener(f,T),c.removeEventListener(E,y),c.removeEventListener("info",b)};v()}).catch(e=>{var t,n;if(e instanceof Error&&(null!==(n=null===(t=e.cause)||void 0===t?void 0:t.code)&&void 0!==n?n:0)>0)throw e;throw o.vF.error("SSE error",e,{path:a.pathname}),e})}},12632:(e,t,n)=>{"use strict";n.d(t,{Hq:()=>s,Qc:()=>i,Tq:()=>l,en:()=>a,mj:()=>r,tl:()=>o});let r="2.18",o="default",i="server",a="mweb",l="windowsapp",s="X-Perplexity-Request-Reason"},16552:()=>{},17385:(e,t,n)=>{"use strict";n.d(t,{d:()=>a});var r=n(25380),o=n(24582);let i=!1,a=()=>{var e,t;let n=(0,r.useRef)(new URL(null!==(t=null===(e=performance.getEntriesByType("navigation").at(0))||void 0===e?void 0:e.name)&&void 0!==t?t:"").pathname);"visible"!==document.visibilityState&&(i=!0);let a=(0,r.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t="ttv";i||n.current!==window.location.pathname||(t="fttv",i=!0),o.L.addDurationVital(t,{startTime:performance.timeOrigin+e,duration:performance.now()-e})},[]);return(0,r.useMemo)(()=>({markTTV:a}),[a])}},24316:(e,t,n)=>{"use strict";n.d(t,{e:()=>o});var r=n(12632);let o=(e,t)=>e?r.en:t?r.Tq:r.tl},24353:(e,t,n)=>{"use strict";n.d(t,{E:()=>i});var r=n(25380),o=n(53362);function i(e){let{session:t,isWindowsApp:n}=e;return(0,r.useEffect)(()=>{if(t){var e;o.yf.setUser({id:t.id,name:null!==(e=t.name)&&void 0!==e?e:"",email:t.email}),o.yf.setGlobalContextProperty("isPro",t.isPro),o.yf.setGlobalContextProperty("isWindowsApp",n)}},[t,n]),null}},25223:(e,t,n)=>{"use strict";n.d(t,{n:()=>r});let r={type:"spring",stiffness:700,damping:50}},62620:(e,t,n)=>{"use strict";n.d(t,{R:()=>o});var r=n(10418);function o(e){if(e)try{return new r(e).getOS().name}catch(e){return}}},69338:(e,t,n)=>{"use strict";n.d(t,{t:()=>i});var r=n(25380),o=n(24582);function i(e){let{session:t,isWindowsApp:n}=e;return(0,r.useEffect)(()=>{if(t){var e;o.L.setUser({id:t.id,name:null!==(e=t.name)&&void 0!==e?e:"",email:t.email}),o.L.setGlobalContextProperty("isPro",t.isPro),o.L.setGlobalContextProperty("isWindowsApp",n)}},[t,n]),null}},72918:(e,t,n)=>{"use strict";n.d(t,{n:()=>o});var r=n(24582);function o(e){if(!e)return;let{ddApplicationId:t,ddClientToken:n,version:o,env:i,debug:a}=e;t&&n&&(r.L.init({applicationId:t,clientToken:n,site:"datadoghq.com",service:"web-nextjs",env:i,version:o,sessionSampleRate:e.sessionSampleRate,sessionReplaySampleRate:e.sessionReplaySampleRate,defaultPrivacyLevel:"mask-user-input",allowedTracingUrls:[/\.perplexity\.ai/,"http://localhost:3000"]}),a&&r.L._setDebug(!0))}},76638:()=>{},92586:(e,t,n)=>{"use strict";n.d(t,{a9:()=>_,Sv:()=>d,G1:()=>g});var r=n(95974),o=n(12632),i=n(908),a=n(60403);"set_to_undefined"===a.env.NEXT_PUBLIC_DEFAULT_SOCKET_URL||a.env.NEXT_PUBLIC_DEFAULT_SOCKET_URL;let l=(e,t)=>{let n=e.replace(/\/+$/,"");return new URL(t.replace(/^\/+/,""),n).toString()};var s=n(24316),c=n(60403);let u=e=>{let t=new URL(e);return globalThis.location.hostname.includes("localhost")||(t.protocol=globalThis.location.protocol,t.hostname=globalThis.location.hostname),t.toString()};function d(){return c.env.NEXT_PUBLIC_REST_ASYNC_SERVER_URL||u("https://testing.i.perplexity.ai")}let v=()=>{let e={};return c.env.NEXT_PUBLIC_CF_ACCESS_ID&&(e["CF-Access-Client-Id"]=c.env.NEXT_PUBLIC_CF_ACCESS_ID),c.env.NEXT_PUBLIC_CF_ACCESS_SECRET&&(e["CF-Access-Client-Secret"]=c.env.NEXT_PUBLIC_CF_ACCESS_SECRET),c.env.NEXT_PUBLIC_PPL_DEV_HEADER_NAME&&c.env.NEXT_PUBLIC_PPL_DEV_HEADER_TOKEN&&(e[c.env.NEXT_PUBLIC_PPL_DEV_HEADER_NAME]=c.env.NEXT_PUBLIC_PPL_DEV_HEADER_TOKEN),c.env.PPL_VERCEL_SSR_CLIENT_HEADER_NAME&&c.env.PPL_VERCEL_SSR_CLIENT_HEADER_TOKEN&&(e[c.env.PPL_VERCEL_SSR_CLIENT_HEADER_NAME]=c.env.PPL_VERCEL_SSR_CLIENT_HEADER_TOKEN),c.env.SERVER_SIDE_CLIENT_TOKEN_HEADER_NAME&&c.env.SERVER_SIDE_CLIENT_TOKEN_HEADER_TOKEN&&(e[c.env.SERVER_SIDE_CLIENT_TOKEN_HEADER_NAME]=c.env.SERVER_SIDE_CLIENT_TOKEN_HEADER_TOKEN),e},h={jwt:null,ttl:0,promise:void 0},f=async()=>{if(h.ttl>Date.now())return h.jwt;try{var e;h.promise=null!==(e=h.promise)&&void 0!==e?e:fetch("/api/auth/token",{headers:{"X-Token-Type":"Perplexity-JWT"}}).then(e=>e.json()).then(e=>e.perplexity_jwt),h.jwt=await h.promise,h.ttl=Date.now()+54e4}catch(e){h.jwt=null,h.ttl=0,r.vF.warn("Error getting dev token:",e)}finally{h.promise=void 0}return h.jwt},E=e=>{let{clientHeaders:t,isMobile:n,isWindowsApp:r}=e,i=(0,s.e)(n,r),a=t instanceof Headers?new Headers(t):new Headers(Object.entries(null!=t?t:{}).filter(e=>void 0!==e[1]).map(e=>{let[t,n]=e;return[t,Array.isArray(n)?n.join(", "):n]})),l=new Headers({...v(),"X-App-ApiClient":i,"X-App-ApiVersion":o.mj});return a.forEach((e,t)=>{l.set(t,e)}),l};async function _(e){var t;let{urlPath:n,timeoutMs:r,method:o,body:a,headers:s,baseUrlOverride:u,redirect:v,numRetries:h,backOffTime:_,reason:g}=e,p=E({clientHeaders:s,isMobile:navigator.userAgent.includes("Mobile"),isWindowsApp:navigator.userAgent.includes("WindowsApp")}),m={headers:p,redirect:v,credentials:"same-origin"},w=null!==(t=globalThis.location.hostname.includes("localhost"))&&void 0!==t&&t,T=c.env.NEXT_PUBLIC_USE_TOKEN_AUTH_FOR_SOCKET;if((w||T)&&m.headers){let e=await f();p.set("authorization","Bearer ".concat(e))}w&&(m.credentials="include");let y=null!=u?u:d(),b=(0,i.QO)(l(y,n));return(0,i.u9)({resource:b,options:m,timeoutMs:r,method:o,body:a,numRetries:h,backOffTime:_,reason:g})}async function g(e){var t;let{url:n,headers:r,...o}=e,a=new URL(n,d()),l=null!==(t=globalThis.location.hostname.includes("localhost"))&&void 0!==t&&t,s=c.env.NEXT_PUBLIC_USE_TOKEN_AUTH_FOR_SOCKET,u={},v="";if(l||s){let e=await f();v="Bearer ".concat(e),u.authorization=v}return(0,i.G1)({url:a,headers:{...r,...u},...o})}},93867:(e,t,n)=>{"use strict";let r;n.d(t,{Qo:()=>y,sx:()=>w,OA:()=>T});var o=n(39861),i=n(92586),a=n(29760),l=n(33031),s=n(95974),c=n(96914);let u=new URL("/ws",(0,i.Sv)());async function d(){return r||(r=new Promise(e=>{let t=new WebSocket(u);t.addEventListener("error",()=>{try{t.close()}finally{r=void 0}}),t.addEventListener("close",()=>{r=void 0}),t.addEventListener("open",()=>{e(t)})}))}u.protocol="wss:";var v=n(60403);let h=new URL("/rest/event/analytics",(0,i.Sv)()),f=new URL("/rest/event/v2/analytics",(0,i.Sv)());function E(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:h;return navigator.sendBeacon(t,new Blob([JSON.stringify(e)],{type:"application/json; charset=UTF-8"}))}function _(){let e={};try{navigator.hardwareConcurrency&&(e.hardwareConcurrency=navigator.hardwareConcurrency);let t=new Float32Array(1),n=new Uint8Array(t.buffer);t[0]=1/0,t[0]=t[0]-t[0];let r=n[3];r&&(e.architecture=r),globalThis.screen.colorDepth&&(e.colorDepth=globalThis.screen.colorDepth),globalThis.screen.width&&globalThis.screen.height&&(e.screenSize="".concat(globalThis.screen.width,"x").concat(globalThis.screen.height))}catch(e){}return e}let g=_(),p=function(){var e,t,n,r;let i,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=arguments.length>1?arguments[1]:void 0,c=Date.now(),u={...a,isStandaloneApp:!1,timestamp:c,isBrowserExtension:!1,timeZone:l.GI,isPro:(null==s?void 0:null===(e=s.user)||void 0===e?void 0:e.subscription_status)&&(null==s?void 0:null===(t=s.user)||void 0===t?void 0:t.subscription_status)!=="none",userId:null==s?void 0:null===(n=s.user)||void 0===n?void 0:n.id,deviceInfo:g},d=globalThis.location.pathname+globalThis.location.search,v=!!getComputedStyle(document.documentElement).getPropertyValue("--arc-palette-title"),h=_(),f=o.A.get("pplx.visitor-id"),E=o.A.get("pplx.session-id");return i=u.internalReferrer?u.internalReferrer:document.referrer,(globalThis.matchMedia("(display-mode: standalone)").matches||globalThis.matchMedia("(display-mode: minimal-ui)").matches||(null===(r=globalThis.navigator)||void 0===r?void 0:r.standalone))&&(u.isStandaloneApp=!0),{eventData:u,pathnameAndParams:d,visitorId:f,isArcBrowser:v,sessionId:E,deviceInfo:h,referrer:i}};function m(e){let{name:t,data:n,session:r,source:o}=e,{eventData:i,visitorId:l,sessionId:c,pathnameAndParams:u,deviceInfo:d,referrer:h,isArcBrowser:f}=p(n,r);if(!u.startsWith("/search/render"))return v.env.NEXT_PUBLIC_EVENT_DEBUG_PRINT&&s.vF.log("[trackEvent] ".concat(t,": "),i),{event_name:t,event_data:i,visitor_id:null!=l?l:"",session_id:null!=c?c:"",url:u,referrer:h,language:(0,a.getChosenLocale)(),screen:y(),hostname:globalThis.location.hostname,device_info:d,is_arc_browser:f,source:o}}function w(e){let t=m(e);t&&(E(t,e.useAnalyticsV2?f:void 0)||((0,c.Rh)("web.browser.analytics.send_event_failed"),d().then(e=>{e.send(JSON.stringify(t))})))}function T(e){let t=e.map(e=>m(e)).filter(e=>void 0!==e);0!==t.length&&(E(t,e[0].useAnalyticsV2?f:void 0)||((0,c.Rh)("web.browser.analytics.send_event_failed"),d().then(e=>{e.send(JSON.stringify(t))})))}function y(){return"".concat(globalThis.screen.width,"x").concat(globalThis.screen.height)}},95974:(e,t,n)=>{"use strict";n.d(t,{n_:()=>c,vF:()=>s,zm:()=>u});var r=n(53362),o=n(24582),i=n(60312);function a(){let e;for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];let o={},i=[];n.filter(Boolean).forEach(t=>{t instanceof Error?(e=t,i.push(t.message)):"object"==typeof t?Object.assign(o,t):i.push(t)});let a=i.join(" ");return e?{message:a,error:e,extra:o}:{message:a,extra:o}}function l(e,t){let{message:n,error:a,extra:l}=t,s=[n,l,a];(0,i.YW)(e).with("error",()=>{r.yf.logger.error(...s);try{o.L.addError(a,{message:n,extra:l})}catch(e){}}).with("warn",()=>r.yf.logger.warn(...s)).with("log",()=>r.yf.logger.info(...s)).with("debug",()=>r.yf.logger.debug(...s)).with("info",()=>r.yf.logger.info(...s)).exhaustive()}let s={log:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];l("debug",a(...t))},error:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];l("error",a(...t))},warn:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];l("warn",a(...t))},debug:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];l("debug",a(...t))},info:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];l("info",a(...t))}};function c(e){let{ddClientToken:t,version:n,env:o,debug:i,sessionSampleRate:a,service:l="web-nextjs"}=e;r.yf.init({clientToken:t,site:"datadoghq.com",service:l,env:o,version:n,sessionSampleRate:a,forwardErrorsToLogs:!0,forwardConsoleLogs:["warn","error","info"],beforeSend:e=>{var t,n,r,o,i;return(null===(t=e.http)||void 0===t||!t.url.includes("reddit.com"))&&((null===(n=e.http)||void 0===n?void 0:n.status_code)===0&&(e.status="warn"),(!((null===(r=e.error)||void 0===r?void 0:r.handling)==="unhandled"&&(null===(o=e.message)||void 0===o?void 0:o.includes("Script error.")))||!!(null===(i=e.error)||void 0===i?void 0:i.cause))&&("error"===e.status||"warn"===e.status||"info"===e.status))}}),i&&(r.yf._setDebug(!0),r.yf.onReady(()=>{r.yf.logger.setHandler("http")}))}function u(e){Object.entries(e).forEach(e=>{let[t,n]=e;r.yf.setGlobalContextProperty(t,n)})}},96914:(e,t,n)=>{"use strict";n.d(t,{Rh:()=>l,KN:()=>u,zm:()=>c,Ip:()=>s});var r=n(24582),o=n(95974);let i="web.custom_metrics";function a(e,t,n){o.vF.info(i,{metricName:e,duration:t,...n})}function l(e){let{verbose:t,raiseOnError:n,...a}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};o.vF.info(i,{metricName:e,...a});let{duration:l,startTime:s,...c}=a;null!=l&&null!=s&&r.L.addDurationVital(e,{startTime:s,duration:l,context:c})}function s(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Date.now();return function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{transport:t=a,nowFromTimeOrigin:n=performance.now()}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r={...e},o=new Set,i=[];function l(e){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=performance.now()-n,l={metricName:e,duration:a};return i.push(l),t(e,a,{...r,...o,startTime:n+performance.timeOrigin}),l}return{addTimingOnce:function(e,t){return o.has(e)?i.find(t=>t.metricName===e):(o.add(e),l(e,t))},addTiming:l,getEvents:()=>i,setGlobalContext(e){Object.assign(r,e)}}}(e,{...t,transport:(e,t,o)=>{a(e,t,o),r.L.addDurationVital(e,{startTime:n,duration:t,context:o})}})}function c(e){Object.entries(e).forEach(e=>{let[t,n]=e;r.L.setGlobalContextProperty(t,n)})}function u(e){if("undefined"==typeof navigator||!navigator.sendBeacon)return;let t=globalThis.location.hostname.includes("localhost");navigator.sendBeacon(new URL("/rest/metrics/collect",t?"https://testing.i.perplexity.ai":globalThis.location.origin),new Blob([JSON.stringify(e)],{type:"application/json"}))}}}]);
//# sourceMappingURL=platform-7c904e355cb22aa4.js.map